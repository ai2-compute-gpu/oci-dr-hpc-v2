{
  "recommendations": {
    "gpu_count_check": {
      "fail": {
        "type": "critical",
        "fault_code": "HPCGPU-0001-0001",
        "issue": "GPU count mismatch detected. Expected count not met (found: {gpu_count})",
        "suggestion": "Verify GPU hardware installation and driver status",
        "commands": [
          "nvidia-smi",
          "lspci | grep -i nvidia",
          "dmesg | grep -i nvidia",
          "sudo nvidia-smi -pm 1"
        ],
        "references": [
          "https://docs.nvidia.com/datacenter/tesla/tesla-installation-notes/",
          "https://docs.oracle.com/en-us/iaas/Content/Compute/References/computeshapes.htm"
        ]
      },
      "pass": {
        "type": "info",
        "issue": "GPU count check passed ({gpu_count} GPUs detected)",
        "suggestion": "GPU hardware is properly detected and configured",
        "commands": [
          "nvidia-smi -q",
          "nvidia-smi topo -m"
        ]
      }
    },
    "pcie_error_check": {
      "fail": {
        "type": "critical",
        "fault_code": "HPCGPU-0002-0001",
        "issue": "PCIe errors detected in system logs",
        "suggestion": "Check PCIe bus health and reseat hardware if necessary",
        "commands": [
          "dmesg | grep -i pcie",
          "dmesg | grep -i 'corrected error'",
          "dmesg | grep -i 'uncorrectable error'",
          "lspci -tv",
          "sudo pcieport-error-inject"
        ],
        "references": [
          "https://docs.oracle.com/en-us/iaas/Content/Compute/References/computeshapes.htm",
          "https://www.kernel.org/doc/Documentation/PCI/pci-error-recovery.txt"
        ]
      },
      "pass": {
        "type": "info",
        "issue": "PCIe error check passed",
        "suggestion": "PCIe bus appears healthy with no errors detected",
        "commands": [
          "lspci -tv",
          "dmesg | tail -50"
        ]
      }
    },
    "rdma_nics_count": {
      "fail": {
        "type": "warning",
        "fault_code": "HPCGPU-0003-0001",
        "issue": "RDMA NIC count mismatch (found: {num_rdma_nics})",
        "suggestion": "Verify RDMA hardware installation and driver configuration",
        "commands": [
          "ibstat",
          "ibv_devices",
          "lspci | grep -i mellanox",
          "rdma link show",
          "systemctl status openibd"
        ],
        "references": [
          "https://docs.oracle.com/en-us/iaas/Content/Compute/Tasks/configuringrdma.htm",
          "https://docs.mellanox.com/display/MLNXOFEDv461000/"
        ]
      },
      "pass": {
        "type": "info",
        "issue": "RDMA NIC count check passed ({num_rdma_nics} NICs detected)",
        "suggestion": "RDMA hardware is properly detected and configured",
        "commands": [
          "ibstat",
          "ibv_devinfo",
          "rdma link show"
        ]
      }
    },
    "rx_discards_check": {
      "fail": {
        "type": "warning",
        "fault_code": "HPCGPU-0004-0001",
        "issue": "RX discards exceeded the specified threshold for {failed_interfaces}",
        "suggestion": "TODO: Suggestion",
        "commands": [
          "TODO: commands"
        ],
        "references": [
          "TODO: references"
        ]
      },
      "pass": {
        "type": "info",
        "issue": "RX discards check passed",
        "suggestion": "RX discards does not exceed a specified threshold",
        "commands": [
            "sudo ethtool -S {interface} | grep rx_prio.*_discards"
        ]
      }
    },
    "gid_index_check": {
      "fail": {
        "type": "critical",
        "fault_code": "HPCGPU-0005-0001",
        "issue": "GID index on a system is not in range",
        "suggestion": "TODO: Suggestion",
        "commands": [
          "TODO: commands"
        ],
        "references": [
          "TODO: references"
        ]
      },
      "pass": {
        "type": "info",
        "issue": "GID index check passed",
        "suggestion": "GID index on a system matches expected values",
        "commands": [
          "sudo show_gids | tail -n +3 | head -n -1"
        ]
      }
    },
    "link_check": {
      "fail": {
        "type": "critical",
        "fault_code": "HPCGPU-0006-0001",
        "issue": "RDMA link check failed - link parameters do not meet expected values",
        "suggestion": "Check RDMA link health, verify cable connections, and inspect link parameters",
        "commands": [
          "ibstat",
          "ibv_devices",
          "rdma link show",
          "sudo mlxlink -d mlx5_0 --show_module --show_counters",
          "sudo ibdev2netdev",
          "lspci | grep -i mellanox"
        ],
        "references": [
          "https://docs.oracle.com/en-us/iaas/Content/Compute/Tasks/configuringrdma.htm",
          "https://docs.mellanox.com/display/MLNXOFEDv461000/",
          "https://community.mellanox.com/s/article/understanding-mlx-link-utility"
        ]
      },
      "pass": {
        "type": "info",
        "issue": "RDMA link check passed",
        "suggestion": "All RDMA links are healthy with expected parameters",
        "commands": [
          "ibstat",
          "rdma link show",
          "sudo mlxlink -d mlx5_0 --show_module"
        ]
      }
    },
    "sram_error_check": {
      "fail": {
        "type": "critical",
        "fault_code": "HPCGPU-0006-0001",
        "issue": "GPU SRAM uncorrectable errors detected (max: {max_uncorrectable}). This indicates serious hardware memory corruption that can cause system instability and data loss.",
        "suggestion": "Immediately investigate GPU memory health. Consider replacing affected GPUs as uncorrectable errors indicate hardware failure. Stop critical workloads until issue is resolved.",
        "commands": [
          "sudo nvidia-smi -q | grep -A 3 Aggregate | grep Correctable",
          "sudo nvidia-smi -q | grep -A 3 Aggregate | grep Uncorrectable",
          "nvidia-smi --query-gpu=memory.total,memory.free,memory.used --format=csv",
          "nvidia-smi --query-gpu=temperature.gpu,power.draw --format=csv",
          "dmesg | grep -i 'gpu\\|nvidia\\|memory'"
        ],
        "references": [
          "https://docs.nvidia.com/deploy/gpu-debug-guidelines/index.html",
          "https://developer.nvidia.com/nvidia-system-management-interface"
        ]
      },
      "pass": {
        "type": "info",
        "issue": "GPU SRAM error levels are within acceptable limits (uncorrectable: {max_uncorrectable}, correctable: {max_correctable})",
        "suggestion": "Continue monitoring GPU memory health as part of regular maintenance",
        "commands": [
          "sudo nvidia-smi -q | grep -A 3 Aggregate | grep Correctable",
          "sudo nvidia-smi -q | grep -A 3 Aggregate | grep Uncorrectable"
        ]
      }
    }
  },
  "summary_templates": {
    "no_issues": "All diagnostic tests passed. Your HPC environment appears healthy.",
    "has_issues": "Found {total_issues} issue(s) requiring attention: {critical_count} critical, {warning_count} warning"
  }
}